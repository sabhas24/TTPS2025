<header class="header">
  <div class="header-container">
    <!-- Logo -->
    <div class="logo-section" routerLink="/">
      <svg class="logo-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path
          d="M12 2C10.8954 2 10 2.89543 10 4C10 5.10457 10.8954 6 12 6C13.1046 6 14 5.10457 14 4C14 2.89543 13.1046 2 12 2Z"
          fill="currentColor" />
        <path d="M7 5C5.89543 5 5 5.89543 5 7C5 8.10457 5.89543 9 7 9C8.10457 9 9 8.10457 9 7C9 5.89543 8.10457 5 7 5Z"
          fill="currentColor" />
        <path
          d="M17 5C15.8954 5 15 5.89543 15 7C15 8.10457 15.8954 9 17 9C18.1046 9 19 8.10457 19 7C19 5.89543 18.1046 5 17 5Z"
          fill="currentColor" />
        <path
          d="M4 11C2.89543 11 2 11.8954 2 13C2 14.1046 2.89543 15 4 15C5.10457 15 6 14.1046 6 13C6 11.8954 5.10457 11 4 11Z"
          fill="currentColor" />
        <path
          d="M20 11C18.8954 11 18 11.8954 18 13C18 14.1046 18.8954 15 20 15C21.1046 15 22 14.1046 22 13C22 11.8954 21.1046 11 20 11Z"
          fill="currentColor" />
        <path
          d="M12 10C9.23858 10 7 12.2386 7 15C7 16.0929 7.29177 17.1175 7.80399 18L16.196 18C16.7082 17.1175 17 16.0929 17 15C17 12.2386 14.7614 10 12 10Z"
          fill="currentColor" />
      </svg>
      <span class="logo-text">PetFind</span>
    </div>

    <!-- Navegación -->
    <nav class="nav-links">
      <ng-container *ngFor="let link of navLinks">
        <a *ngIf="!link.requiereLogin || (authService.loggedIn$ | async)" [routerLink]="link.path"
          routerLinkActive="active-link" [routerLinkActiveOptions]="{ exact: true }" class="nav-link">
          {{ link.label }}
        </a>
      </ng-container>
    </nav>

    <!-- Auth section con menú de usuario -->
    <div class="auth-section">
      <ng-container *ngIf="!(authService.loggedIn$ | async); else userMenu">
        <a routerLink="/login" class="btn btn-outline">Iniciar Sesión</a>
        <a routerLink="/register" class="btn btn-primary">Registrarse</a>
      </ng-container>

      <ng-template #userMenu>
        <div class="user-menu-container">
          <button class="user-menu-button" (click)="toggleUserMenu()" [class.active]="isUserMenuOpen">
            <!-- Mostrando inicial del usuario en lugar de icono genérico -->
            <div class="user-avatar">
              <span class="user-initial">{{ getUserInitial() }}</span>
            </div>
            <div class="user-info">
              <span class="user-name">{{ authService.getNombreCompleto() }}</span>
              <span class="user-status">En línea</span>
            </div>
            <svg class="chevron-icon" [class.rotate]="isUserMenuOpen" xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
          </button>

          <div class="user-dropdown" *ngIf="isUserMenuOpen">
            <div class="dropdown-header">
              <!-- También mostrando inicial en el dropdown -->
              <div class="dropdown-user-avatar">
                <span class="user-initial">{{ getUserInitial() }}</span>
              </div>
              <div class="dropdown-user-info">
                <p class="dropdown-user-name">{{ authService.getNombreCompleto() }}</p>
                <p class="dropdown-user-email">{{ (authService.usuario$ | async)?.email }}</p>
              </div>
            </div>

            <div class="dropdown-divider"></div>

            <a routerLink="/perfil" class="dropdown-item" (click)="closeUserMenu()">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                stroke-width="2">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                <circle cx="12" cy="7" r="4"></circle>
              </svg>
              <span>Mi Perfil</span>
            </a>

            <a routerLink="/mascotas/mis-mascotas" class="dropdown-item" (click)="closeUserMenu()">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                stroke-width="2">
                <circle cx="11" cy="4" r="2"></circle>
                <circle cx="18" cy="8" r="2"></circle>
                <circle cx="20" cy="16" r="2"></circle>
                <circle cx="9" cy="10" r="2"></circle>
                <circle cx="15" cy="13" r="3"></circle>
              </svg>
              <span>Mis Mascotas</span>
            </a>

            <a routerLink="/mascotas/crear" class="dropdown-item" (click)="closeUserMenu()">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                stroke-width="2">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
              </svg>
              <span>Registrar Mascota Perdida</span>
            </a>

            <div class="dropdown-divider"></div>

            <button class="dropdown-item logout-item" (click)="logout()">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                stroke-width="2">
                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                <polyline points="16 17 21 12 16 7"></polyline>
                <line x1="21" y1="12" x2="9" y2="12"></line>
              </svg>
              <span>Cerrar Sesión</span>
            </button>
          </div>
        </div>
      </ng-template>
    </div>
  </div>
</header>
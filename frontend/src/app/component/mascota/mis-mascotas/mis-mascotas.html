<app-home-header></app-home-header>

<main class="mis-mascotas-page">
  <div class="header-section">
    <h1>{{ titulo }}</h1>
    <p *ngIf="totalElementos > 0 && !cargando" class="contador">
      {{ totalElementos }} {{ totalElementos === 1 ? 'mascota' : 'mascotas' }}
      {{ modo === 'usuario' ? 'registrada(s)' : 'perdida(s)' }}
    </p>
  </div>

  <!-- Estado de carga -->
  <div *ngIf="cargando" class="loading-spinner">Cargando...</div>

  <!-- Error global -->
  <div *ngIf="error" class="error-message-global">{{ error }}</div>

  <!-- Contenido principal -->
  <div *ngIf="!cargando && !error">

    <!-- Si no hay mascotas -->
    <div *ngIf="mascotasPaginadas.length === 0" class="no-mascotas">
      <p *ngIf="modo === 'usuario'">No tienes mascotas registradas.</p>
      <p *ngIf="modo === 'perdidas'">No hay mascotas perdidas en este momento.</p>
      <button *ngIf="modo === 'usuario'" routerLink="/mascotas/registrar" class="btn-registrar">
        Registrar Primera Mascota
      </button>
    </div>

    <!-- Lista de mascotas -->
    <div *ngIf="mascotasPaginadas.length > 0" class="mascotas-list">

      <!-- Agregando navegaci贸n al detalle de mascota -->
      <div *ngFor="let mascota of mascotasPaginadas" class="mascota-card" (click)="verDetalle(mascota.id)">

        <!-- Imagen segura -->
        <img [src]="mascota.fotos && mascota.fotos.length > 0 ? mascota.fotos[0] : 'assets/no-image.png'"
          alt="{{ mascota.nombre }}" />

        <div class="info">
          <h3>{{ mascota.nombre }}</h3>

          <p><strong>Barrio:</strong> {{ mascota.coordenada.barrio }}</p>
          <p><strong>Color:</strong> {{ mascota.color }}</p>
          <p *ngIf="mascota.descripcionExtra" class="descripcion">{{ mascota.descripcionExtra }}</p>

          <p *ngIf="modo === 'perdidas'" class="estado-badge">
            <span class="badge perdida"> Perdida</span>
          </p>

          <!-- Evitando propagaci贸n de eventos en los botones de acci贸n -->
          <div *ngIf="mostrarAcciones" class="acciones" (click)="$event.stopPropagation()">
            <button class="btn-editar" (click)="editarMascota(mascota.id)">Editar</button>
            <button class="btn-eliminar" (click)="eliminarMascota(mascota.id)">Eliminar</button>
          </div>

          <div *ngIf="modo === 'perdidas'" class="acciones-perdidas" (click)="$event.stopPropagation()">
            <button class="btn-reportar" (click)="irAReportarAvistamiento(mascota.id)">Reportar Avistamiento</button>
          </div>
        </div>

      </div>
    </div>

    <!-- Controles de paginaci贸n -->
    <div class="paginacion" *ngIf="totalPaginas > 1">

      <button class="btn-pag" (click)="paginaAnterior()" [disabled]="paginaActual === 1">
        &laquo; Anterior
      </button>

      <ng-container *ngFor="let p of paginasArray()">
        <button class="btn-pag" [class.active]="p === paginaActual" (click)="irAPagina(p)">
          {{ p }}
        </button>
      </ng-container>

      <button class="btn-pag" (click)="siguientePagina()" [disabled]="paginaActual === totalPaginas">
        Siguiente &raquo;
      </button>

    </div>

  </div>
</main>